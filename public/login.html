<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            background: url('img/background.jpg') no-repeat center center fixed;
            background-size: cover;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.85);
            width: 400px;
            max-width: 90%;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .login-container img {
            width: 100px;
            display: block;
            margin: 0 auto 10px;
        }

        .login-container h2 {
            font-weight: bold;
            text-align: center;
            color: #e00000; /* สีแดงเข้ม */
            margin-bottom: 20px;
        }

        .form-control:focus {
            box-shadow: none;
            border-color: #e00000;
        }

        .btn-login {
            background-color: #e00000;
            border: none;
        }

        .btn-login:hover {
            background-color: #c00000;
        }

        .form-check-label {
            color: #555;
        }

        .forgot-password {
            text-decoration: none;
            color: #e00000;
            font-size: 0.9em;
        }

        .forgot-password:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <div class="login-container">
        <img src="img/TU.png" alt="TU Logo">
        <h2>TU LOGIN</h2>
        <form>
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                    <input type="text" class="form-control" id="username" placeholder="Enter username">
                </div>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-lock"></i></span>
                    <input type="password" class="form-control" id="password" placeholder="Enter password">
                </div>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="rememberMe">
                    <label class="form-check-label" for="rememberMe">Remember me</label>
                </div>
                <a href="#" class="forgot-password">Forgot password?</a>
            </div>
            <button type="button" onclick="submitLoginAndRedirect()" class="btn btn-login btn-primary w-100">Login</button>
        </form>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
    <script>
        function submitLoginAndRedirect() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    // ตรวจสอบว่า username และ password ไม่ว่าง
    if (!username || !password) {
        alert("Please enter both username and password.");
        return;
    }

    // สมมติว่าเราทำการส่งข้อมูลไปยัง API และได้รับการตอบกลับ (response)
    // ตัวอย่างการเก็บข้อมูลที่ตอบกลับจาก API
    const data = {
        status: 'true',
        message: 'Successful',
        type: 'student',
        tu_status: 'ปกติ',
        statusid: '100',
        displayname_th: 'ณภัทร โตรุ่งเรืองยศ',
        displayname_en: 'naphat torungruengyos',
        email: 'naphat.tor@dome.tu.ac.th',
        department: 'ปริญญาตรีภาคพิเศษ สาขาวิชาวิทยาการคอมพิวเตอร์',
        faculty: 'คณะวิทยาศาสตร์และเทคโนโลยี'
    };

    // เก็บข้อมูลทั้งหมดใน sessionStorage
    sessionStorage.setItem('status', data.status);
    sessionStorage.setItem('tu_status', data.tu_status);
    sessionStorage.setItem('message', data.message);
    sessionStorage.setItem('username', username);
    sessionStorage.setItem('displayname_th', data.displayname_th);
    sessionStorage.setItem('displayname_en', data.displayname_en);
    sessionStorage.setItem('statusid', data.statusid);
    sessionStorage.setItem('email', data.email);
    sessionStorage.setItem('type', data.type);
    sessionStorage.setItem('department', data.department);
    sessionStorage.setItem('faculty', data.faculty);

    // เปลี่ยนหน้าไปที่ submitLogin.html
    window.location.href = 'loginSucc.html';
}

function submitLogin() {
    console.log('submitLogin function started');
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    const apiKey = 'TUa9dcde19734981739fbc877c2c23aafa9178eb66b505093111b0980eaaf6bfe548624c65aac8fe29718172dcfce55f00';  // ใส่รหัสที่คุณต้องการตรวจสอบที่นี่

    console.log('Username:', username);
    console.log('Password:', password);

    // ตรวจสอบว่า API Key ถูกต้อง
    if (apiKey !== 'TUa9dcde19734981739fbc877c2c23aafa9178eb66b505093111b0980eaaf6bfe548624c65aac8fe29718172dcfce55f00') {
        alert('Invalid API Key. Please check your credentials.');
        return;  // หยุดการดำเนินการหาก API Key ไม่ถูกต้อง
    }

    // ส่งคำขอไปยัง API
    fetch('https://restapi.tu.ac.th/api/v1/auth/Ad/verify', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Application-Key': apiKey
        },
        body: JSON.stringify({ "UserName": username, "PassWord": password })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            // เก็บข้อมูลลงใน sessionStorage
            sessionStorage.setItem('status', data.status);
            sessionStorage.setItem('tu_status', data.tu_status);
            sessionStorage.setItem('message', data.message);
            sessionStorage.setItem('username', data.username);
            sessionStorage.setItem('displayname_th', data.displayname_th);
            sessionStorage.setItem('displayname_en', data.displayname_en);
            sessionStorage.setItem('statusid', data.statusid);
            sessionStorage.setItem('email', data.email);
            sessionStorage.setItem('type', data.type);
            sessionStorage.setItem('department', data.department);
            sessionStorage.setItem('faculty', data.faculty);

            // เปลี่ยนหน้าไปยัง loginSucc.html
            window.location.href = 'loginSucc.html';

            // ตรวจสอบว่ามีการเก็บข้อมูลใน sessionStorage หรือไม่
            console.log('Stored status:', sessionStorage.getItem('status'));
        } else {
            // แจ้งเตือนหากการล็อกอินไม่สำเร็จ
            alert('Login failed: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Login failed. Please check your credentials.');
    });
}


    </script>
</body>

</html>
